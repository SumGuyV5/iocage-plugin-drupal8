#!/bin/sh

set_sslkey()
{
  if [ $? -eq 0 ] && [ $1 != "" ] ; then
    echo "Changing /usr/local/etc/apache24/ssl/private.key..."
    echo $1 > /usr/local/etc/apache24/ssl/private.key
  else
    echo "Error when updateing /usr/local/etc/apache24/ssl/private.key">2 ; exit 1
  fi
  exit 0
}

set_sslcert()
{
  if [ $? -eq 0 ] && [ $1 != "" ] ; then
    echo "Changing /usr/local/etc/apache24/ssl/certificate.crt..."
    echo $1 > /usr/local/etc/apache24/ssl/certificate.crt
  else
    echo "Error when updateing /usr/local/etc/apache24/ssl/certificate.crt">2 ; exit 1
  fi
  exit 0
}

set_drupaltrust()
{
  input=$1
  if [ $? -eq 0 ] && [ $input != "" ] ; then
    echo "Changing /usr/local/www/drupal8/sites/default/settings.php..."
    sed -i.bak '/\$settings\['\''trusted_host_patterns'\''] = \[/,/];/{ :q
    N
    $!bq
    s/.*/\$settings\['\''trusted_host_patterns'\''] = \[\
  '${input}'\
];/g;}' settings.php
    sed -i.bak '/\$settings\['\''trusted_host_patterns'\''] = \[/,/];/{s/\./\\\./g;}' settings.php
  else
    echo "Error when updateing /usr/local/www/drupal8/sites/default/settings.php">2 ; exit 1
  fi
  exit 0
}

set_apacheconf()
{
  if [ $? -eq 0 ] && [ $1 != "" ] ; then
    echo "Changing /usr/local/etc/apache24/Includes/drupal.conf..."
    echo $1 > /usr/local/etc/apache24/Includes/drupal.conf
  else
    echo "Error when updateing /usr/local/etc/apache24/Includes/drupal.conf">2 ; exit 1
  fi
  exit 0
}

set_adminpasswd()
{
  PASSWD=$1
  if [ $? -eq 0 ] && [ $PASSWD != "" ] ; then
    echo "Changing Drupal Admin password..."
    drush user-password admin --password="$PASSWD" -r /usr/local/www/drupal8
  else
    echo "Error when updateing Drupal 8 admin password.">2 ; exit 1
  fi
  exit 0
}


# Stub for something which sets quasselsettings
case $1 in
	sslkey) set_sslkey $2 ;;
	sslcert) set_sslcert $2 ;;
	drupaltrust) set_drupaltrust $2 ;;
	apacheconf) set_apacheconf $2 ;;
  adminpasswd) set_adminpasswd $2 ;;
	*) echo "Unknown option" ;;
esac